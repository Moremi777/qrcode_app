{% extends 'base.html' %}
{% block content %}
<h2 class="text-center mt-4">Upload Your Media</h2>
<form method="post" enctype="multipart/form-data" class="mt-4">
    {% csrf_token %}
    <div class="mb-3">
        <input type="file" name="file" class="form-control" required>
    </div>
    <button type="submit" class="btn btn-success btn-lg w-100">Generate QR Code</button>
</form>

{% if media %}
<div class="mt-5 text-center">
    <h3>Your QR Code</h3>
    <img src="{{ media.qr_code.url }}" alt="QR Code" id="qr-code" class="img-fluid rounded shadow mb-3">
    <p><a href="{{ media.file.url }}" target="_blank" class="btn btn-primary btn-lg">View Media</a></p>

    <!-- Share Button -->
    <div class="mt-3">
        <h4>Share QR Code</h4>
        <button id="share-button" class="btn btn-info btn-lg">Share this QR Code</button>
    </div>
</div>
{% endif %}

<script>
    document.getElementById('share-button').addEventListener('click', async () => {
        const qrCodeUrl = document.getElementById('qr-code').src;

        if (navigator.share) {
            try {
                await navigator.share({
                    title: 'Check out this QR Code!',
                    text: 'Scan this QR Code to view the media.',
                    url: qrCodeUrl, // Share the QR code URL
                });
                alert('QR Code shared successfully!');
            } catch (error) {
                console.error('Error sharing:', error);
                alert('Sharing failed. Please try again.');
            }
        } else {
            alert('Sharing is not supported on this browser.');
        }
    });
</script>
{% endblock %}
